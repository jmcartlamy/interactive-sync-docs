---
id: javascript-implementation
title: JavaScript Implementation
---

The integration of Interactive Sync in JavaScript language is the easiest way to create an interactive application.

Only a registered app on [Twitch](https://dev.twitch.tv/console/apps/create) and a WebSocket connection with the "Extension Backend Service" (EBS) are required to send "[User Interface](/docs/getting-started/create-ui)" and to receive messages.

ℹ️ Before starting, you have to **follow the [prerequisites](/docs/getting-started/registering-your-application)** to retrieve a client ID.

## Implementation

### Connect with Twitch

To retrieve an access token generated by Twitch, send your user you want to authenticate to [your registered redirect URI](/docs/getting-started/registering-your-application#register). _(eg: http://localhost:8080)_

In this page, you have to **create a call-to-action** _(eg: a button with an event listener)_ which will be used to connect with Twitch:

```javascript
var button = document.getElementById('button');

button.addEventListener('click', function () {
    location.href =
        'https://id.twitch.tv/oauth2/authorize' +
        '?client_id=<your client ID>' +
        '&redirect_uri=<your registered redirect URI>' +
        '&response_type=token';
});
```

When an user authorizes (or not) your application, he is redirected to your redirect URL in this format:

```vim
https://<your registered redirect URI>#access_token=<an access token>
```

Get this access token when **a fragment, a string preceded by a hash (#), is in the URI**:

```javascript
if (window.location.hash) {
    var match = window.location.hash.match(new RegExp('access_token=([^&]*)'));
    var accessToken = match && match[1];

    if (accessToken) {
        // A WebSocket connection
    } else {
        console.log('No access token');
    }
}
```

### Establish a WebSocket connection

When you have an access token with your client ID, **establish a secure WebSocket connection** with these two key-value pair required query-string parameters.

**Create two functions which handle the connection / disconnection**:

```javascript
var status = 0;
var socket = null;

function setupWebSocket(accessToken, callback) {
    var url = process.env.NODE_ENV === 'production' ? 'wss://<your host>' : 'ws://localhost:8081/';
    var query = '?client_id=<your client ID>&access_token=' + accessToken;

    try {
        socket = new WebSocket(url + query);
    } catch (err) {
        throw Error(err);
    }

    socket.onopen = function () {
        status = 1; // Connected
        if (callback) callback(1);
    };
    socket.onerror = function () {
        status = 3; // Error
        if (callback) callback(3);
    };
}

function disconnectWebSocket() {
    socket.close();
    status = 2; // Disconnected
}
```

**Call `setupWebSocket` function with a `callback` function** to establish a secure connection _(in the "access token" condition)_:

```javascript
setupWebSocket(accessToken, function (status) {
    if (status === 1) {
        // Connection established, ready to receive messages
    } else if (status === 3) {
        // An error occured
    }
});
```

### Receive Messages

Add a listener to be able to receive messages as soon as the connection is established.

```javascript
socket.addEventListener('message', function (event) {
    var data = JSON.parse(event.data);
    if (data.context === 'connection') {
        if (data.status === 'ok') {
            // Everything is fine
        }
        if (data.status === 'error') {
            // EBS terminates the connection for a specific reason
            console.log(event.data.message);
        }
    }
});
```

After a successful connection, a message is sent to indicate the status and if the connection is maintained.

```json
{
    "status": "ok",
    "context": "connection",
    "message": "You are well connected with the channel",
    "data": { "displayName": "XXXXXX", "channelId": "XXXXXXX" }
}
```

Find out more about [WebSocket](/docs/websocket) on the dedicated page.

:::important

You will receive message in plain text but with the JSON structure. **Don't forget to parse before processing**.

:::

### Send Messages

If everything is fine, congratuations! You can send messages alias "[User Interface](/docs/user-interface/root)" to the EBS in stringify JavaScript Object Notation (JSON).

For example, try to send an user interface with this script:

```javascript
socket.send(
    JSON.stringify({
        context: 'user_interface',
        data: {
            id: '1',
        },
    })
);
```

Each message sent results in a positive response or negative response with the reason for the failure:

```json
{
    "status": "ok",
    "context": "message",
    "message": "Message was well received and transfered to Twitch API.",
    "data": null
}
```

:::caution

You will receive an **error message** if a parsing error occured with the JSON received. **Verify your JSON before sending**.

:::
